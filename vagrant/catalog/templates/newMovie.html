{% extends 'main.html' %}
{% block content %}

<h1>Add New Movie:</h1>

<form onsubmit="movieInfo()" action="#" id="form">
    <div class="form-group">
        <label for="title">Title:</label>
        <input type="text" name="title" maxlength="250" id="title" class="form-control" placeholder="Name of Movie"
            aria-describedby="helpId">
        <label for="year"></label>
        <input type="text" name="year" maxlength="4" id="year" class="form-control">
        <label for="plot"></label>
        <input type="text" name="plot" maxlength="250" id="plot" class="form-control">
        <label for="poster"></label>
        <input type="text" name="poster" maxlength="250" id="poster" class="form-control">
        <button type="submit" class="btn btn-default" id="submit"><span aria-hidden="true"></span>Create</button>
    </div>

</form>
<script>
    const apikey = 'ce21af22'
    const url = 'https://www.omdbapi.com/?t='
    let year;
    let plot;
    let poster;

    function movieInfo() {
        const form = document.getElementById('form')
        const att = document.createAttribute('method')
        att.value = "POST"
        form.setAttributeNode(att)
        const title = document.getElementById('title').value
        console.log(title)
        return fetch(url + title + '&apikey=' + apikey)
            .then(response => response.json())
            .then(data => {
                document.getElementById('year').value = data.Year;
                document.getElementById('plot').value = data.Plot;
                document.getElementById('poster').value = data.Poster;
                form.submit();
            })
            .catch(console.error)
    }
</script>

{% endblock %}